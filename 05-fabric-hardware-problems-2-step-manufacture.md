# Особенности производства аппаратуры

<!-- Монтаж РЭА -->

Для того чтобы перейти к вопросу о том, почему нам необходимо отделять Hardware от Software, сперва необходимо обозначить несколько примеров организации производственного процесса для микроэлектроники. Для этого весьма поверхностно обозначим несколько примеров (в данном случае мы не делаем попытку претендовать на полноту рассмотрения).

Первым этапом является проектирование электронного устройства на принципиальном уровне (схемы электрические принципиальные), в рамках которого определяется поведение системы. После этого выполняется адаптация под конкретный способ производства или, в некоторых случаях, под конкретное производство.

[**Навесной монтаж**](https://ru.wikipedia.org/wiki/Навесной_монтаж) --- способ монтажа электронных схем, при котором расположенные на изолирующем шасси радиоэлементы соединяются друг с другом проводами или непосредственно выводами.

Недостаток навесного монтажа --- плохо поддаётся автоматизации и обычно выполняется монтажниками вручную. В настоящее время в массовом производстве применяется редко и обычно только при монтаже крупногабаритных деталей.

Для навесного монтажа часто используются так называемые макетные или монтажные платы, которые являются универсальной "платой" для прототипирования простых электронных схем, не требующих высокого уровня интеграции (элементы крупные, и их немного).

[**Монтаж на печатную плату**](https://ru.wikipedia.org/wiki/Печатная_плата). Печатная плата --- пластина из диэлектрика, на поверхности и/или в объёме которой сформированы электропроводящие цепи электронной схемы. Печатная плата предназначена для электрического и механического соединения различных электронных компонентов. Электронные компоненты на печатной плате соединяются своими выводами с элементами проводящего рисунка обычно пайкой.

Печатные платы классифицируются, в том числе и по количеству слоев металлизации, выделяются как одно- и двухслойные платы (проводники проходят только по поверхности платы), так и многослойные платы, где количество слоев обуславливается практической целесообразностью: действительно сложные платы физически невозможно "развести" на двух слоях, когда отдельные компоненты имеют сотни выходных контактов.

Монтаж на печатную плату позволяет использовать гораздо более мелкую элементную базу, когда размер элементов составляет десятые доли миллиметров (навесной монтаж в таком случае является практически невозможным); использовать элементы с огромным количеством контактов (например [BGA](https://en.wikipedia.org/wiki/Ball_grid_array)); добиться гораздо более технологичного процесса производства и высокого качества, необходимого для высокочастотных устройств (к примеру, выравнивание длины проводников); получить невозможный для навесного монтажа уровень интеграции; и т.д. Современные печатные платы, помимо проводников, могут также содержать и пассивные элементы, встроенные в слои металлизации.

В то же время использование печатных плат удлиняет производственную цепочку (выделяется этап подготовки документации на плату и ее производство перед монтажом) и затрудняет возможность что-то исправить после производства (разрезать проводник или "бросить контакт", по сути, можно, только если это внешний слой).

## Интегральные схемы. Кремниевое производство

**Интегральные схемы** 
: --- микроэлектронное изделие, выполняющее определенную функцию преобразования, обработки сигнала, накапливания информации и имеющее высокую плотность электрически соединенных элементов (или элементов и компонентов), которые с точки зрения требований к испытаниям, приемке, поставке и эксплуатации рассматриваются как единое целое.

Производство интегральных микросхем – это сложный и многогранный процесс, требующий высокой точности и продвинутых технологий. Понимание этапов производства и технологий, используемых в этом процессе, критично для разработки новых и улучшения существующих электронных устройств

### Этапы производства микросхем

1. **Этап 1: Выращивание монокристалла кремния (Метод Чохральского)**

![Метод Чохральского](https://ru.dsisolar.com/Content/uploads/2021377093/20210330121440d8e0d9f9cf6b4b938edbc7c505770860.jpg)

Этот начальный этап создает основу для производства ИС, формируя монокристаллический кремний сверхвысокой чистоты. Общепринятым методом является **[метод Чохральского](https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%A7%D0%BE%D1%85%D1%80%D0%B0%D0%BB%D1%8C%D1%81%D0%BA%D0%BE%D0%B3%D0%BE#:~:text=%D0%9C%D0%B5%CC%81%D1%82%D0%BE%D0%B4%20%D0%A7%D0%BE%D1%85%D1%80%D0%B0%CC%81%D0%BB%D1%8C%D1%81%D0%BA%D0%BE%D0%B3%D0%BE%20%E2%80%94%20%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%20%D0%B2%D1%8B%D1%80%D0%B0%D1%89%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%BC%D0%BE%D0%BD%D0%BE%D0%BA%D1%80%D0%B8%D1%81%D1%82%D0%B0%D0%BB%D0%BB%D0%BE%D0%B2,%D0%BE%D1%80%D0%B8%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D0%B8%20%D0%B2%20%D0%BA%D0%BE%D0%BD%D1%82%D0%B0%D0%BA%D1%82%20%D1%81%D0%BE%20%D1%81%D0%B2%D0%BE%D0%B1%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9)**, при котором чистый кремний плавится в специальной печи при очень высокой температуре (около 1414°C). Затравочный кристалл погружается в расплав и затем медленно вытягивается вверх с одновременным вращением. Этот контролируемый процесс приводит к образованию большого цилиндрического слитка (буля) монокристаллического кремния, который может достигать 300 мм в диаметре (чистота >99,9999999%, менее 1 атома примеси на 1 млрд атомов).

2. **Этап 2: Резка на пластины (Wafering)**

![Wafering](https://st.quantrimang.com/photos/image/2018/04/09/cach-tao-cpu-4.jpg)

После выращивания монокристаллический слиток нарезают алмазными пилами на тонкие пластины (**вафли**) диаметром 10–30 см и толщиной 0,5–1 мм (обычно p-типа, легирование ~2×10²¹ см⁻³). Поверхность может дополнительно легироваться, а затем наращивается эпитаксиальный слой с противоположной проводимостью для улучшения электрических свойств. Нарезка обеспечивает плоскую поверхность, пластины проверяются на дефекты. Вафли служат подложкой для создания тысяч микросхем, являясь основой для полупроводниковых структур (транзисторов, соединений).

3. **Этап 3: Полировка и очистка**

![Wafer](https://st.quantrimang.com/photos/image/2018/04/09/cach-tao-cpu-5.jpg)

После нарезки пластины полируют до зеркального блеска мелкозернистыми абразивами, устраняя микротрещины и неровности. Очистка проводится в сверхчистых помещениях (**[ISO 1–3](https://www.texwipe.com/iso-1-3-ultra-clean)**, 1–10 частиц/фут³) с использованием деионизованной воды, азота, химических растворов, ультразвука или плазмы для удаления пыли и загрязнений. Безупречно гладкая и чистая поверхность необходима для фотолитографии, так как малейшие дефекты или частицы могут вызвать ошибки в нанометровых структурах, снижая надежность микросхем.

4. **Этап 4: Фотолитография**

![Фотолитография](https://image2.slideserve.com/4827519/slide14-l.jpg)

**Фотолитография**
: --- это фундаментальный итеративный процесс, используемый для переноса сложных рисунков с фотошаблона на поверхность пластины, что позволяет проводить селективную обработку определенных областей.

Этот этап включает следующие ключевые шаги:

- **Формирование окисного слоя:**

    На всей поверхности пластины может быть сформирован тонкий слой двуокиси кремния (**SiO₂**), часто путем выдержки пластины в атмосфере из смеси кислорода и водорода при температуре около 1000°С. Этот слой может служить в качестве электрического изолятора или подзатворного диэлектрика для транзисторов.

- **Нанесение фоторезиста:**

    На поверхность пластины равномерно наносится тонкий слой светочувствительного полимера, называемого **[фоторезистом](https://ru.wikipedia.org/wiki/%D0%A4%D0%BE%D1%82%D0%BE%D1%80%D0%B5%D0%B7%D0%B8%D1%81%D1%82)**, обычно толщиной около 1 мкм, методом центрифугирования (вращения). Фоторезист может быть негативным (становится нерастворимым при воздействии света) или позитивным (становится растворимым после освещения), что определяет, какие области будут удалены на следующем этапе.

![фоторезист](https://droider.ru/wp-content/uploads/2020/08/image11-1.png)

- **Пошаговое экспонирование:**

    Стеклянная маска (**[фотошаблон](https://ru.wikipedia.org/wiki/%D0%A4%D0%BE%D1%82%D0%BE%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD)**) с требуемым рисунком помещается в непосредственной близости от поверхности пластины. Затем пластина подвергается воздействию ультрафиолетового света. Маска непрозрачна в областях, которые должны быть защищены (при использовании негативного фоторезиста), или прозрачна в областях, подлежащих обработке.

- **Проявление и дубление фоторезиста:**

    Пластина обрабатывается в проявителе (кислотном или щелочном растворе) для удаления областей фоторезиста, которые не были облучены светом (при использовании негативного резиста). После проявления фоторезист может быть подвергнут "мягкому дублению" при низкой температуре для увеличения его стойкости к последующим процессам.

- **Травление:**

    Материал в областях пластины, не закрытых фоторезистом, селективно удаляется. Это может быть выполнено с использованием химических растворов (**[мокрое травление](https://shengenfab.com/ru/dry-etching-vs-wet-etching/)**) или плазмы (**[сухое травление](https://shengenfab.com/ru/dry-etching-vs-wet-etching/)**), в зависимости от удаляемого материала и требуемой точности.

- **Отмывка и сушка:**

    Пластина тщательно промывается деионизованной водой для удаления остатков химикатов и загрязнений, а затем сушится азотом в условиях сверхчистых помещений.

- **Различные обработки:**

    Открытые области на пластине теперь готовы к различным технологическим операциям, таким как ионная имплантация, осаждение металла или другие процессы, необходимые для формирования структур.

- **Удаление фоторезиста:**

    Оставшийся слой фоторезиста, который служил маской, удаляется, часто с использованием обработки в высокотемпературной плазме, которая эффективно сжигает полимер, не повреждая нижележащие слои.

5. **Этап 5: Диффузия и ионная имплантация**

![Диффузия и ионная имплантация](https://st.quantrimang.com/photos/image/2018/04/09/cach-tao-cpu-13.jpg)

**Ионная имплантация**
: --- это основной метод изменения электрических свойств кремния путем контролируемого внедрения легирующих примесей (допантов) в определенные области пластины.

Этот процесс используется для создания различных областей с проводимостью p-типа (например, путем имплантации бора) или n-типа (например, путем имплантации фосфора). После имплантации, повреждающей решетку, проводится отжиг (~1000°C, 15–30 мин) для восстановления структуры и активации допантов. Метод критичен для точного контроля характеристик транзисторов и схем.

6. **Этап 6: Металлизация**

![Металлизация](https://st.quantrimang.com/photos/image/2018/04/09/cach-tao-cpu-16.jpg)

**Металлизация**
: --- это процесс создания электрических соединений (межсоединений) между отдельными компонентами (такими как транзисторы) на кристалле микросхемы. 

Металлизация создает электрические соединения между компонентами микросхемы (транзисторами) путем нанесения проводящих слоев (алюминий, медь, вольфрам) методом распыления или другими способами. Процесс включает: нанесение изолятора (SiO₂), травление контактных отверстий (vias) для связи слоев, осаждение металла и формирование рисунка проводников с помощью фотолитографии. Цикл повторяется для многослойной структуры межсоединений. Качественная металлизация обеспечивает надежную "электрическую сеть", соединяющую миллиарды элементов, предотвращая обрывы, замыкания или рост сопротивления.

7. **Этап 7: Планаризация (выравнивание поверхности)**
  
**Планаризация**
: --- это важный этап, который проводится для обеспечения максимально плоской поверхности пластины перед нанесением каждого последующего слоя, особенно в процессе создания многослойных структур межсоединений.

Ключевым методом является **[химико-механическая полировка (CMP)](https://ru.wikipedia.org/wiki/%D0%A5%D0%B8%D0%BC%D0%B8%D0%BA%D0%BE-%D0%BC%D0%B5%D1%85%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D0%BF%D0%BB%D0%B0%D0%BD%D0%B0%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)**.CMP использует абразивную суспензию (оксид алюминия или кремния в жидкости) и механическую полировку для удаления излишков материала и "ступенек". Без планаризации неровности приводят к неравномерному нанесению фоторезиста, неточностям фотолитографии, плохому покрытию металлом и ненадежным межсоединениям. Процесс обеспечивает плоскостность, повышая качество и надежность микросхем.

### Закон Мура и его ограничения

**[Закон Мура](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BA%D0%BE%D0%BD_%D0%9C%D1%83%D1%80%D0%B0)** — это эмпирическое наблюдение, сформулированное Гордоном Муром, сооснователем компании Intel, в 1965 году. 

> Количество транзисторов на кристалле интегральной схемы удваивается примерно каждые 24 месяца, что приводит к экспоненциальному росту вычислительной мощности

Закон Мура не является физическим законом, а скорее прогнозом, основанным на тенденциях в развитии технологий. Он оказал огромное влияние на индустрию, задавая темпы инноваций и стимулируя конкуренцию между производителями микропроцессоров. Однако в последние годы закон Мура сталкивается с рядом ограничений, которые делают его дальнейшее выполнение затруднительным, такие как закон Амдала, сложность параллельного программирования, проблемы доставки данных, тепловыделение и питание (Dark Silicon), а также физические ограничения процессов производства.

**1. Формулировка закона Мура**

- **1965**: Гордон Мур предсказал удвоение числа транзисторов на кристалле ежегодно (основываясь на ранних тенденциях).
- **1975**: Мур пересмотрел прогноз — удвоение каждые ~24 месяца (наиболее известная версия).
- **Вариант Хауса**: Дэвид Хаус (Intel) предложил, что производительность процессоров удваивается каждые ~18 месяцев за счет роста числа транзисторов и тактовой частоты.

**2. Влияния закона Мура**

Закон Мура стал движущей силой технологического прогресса, обеспечив следующие ключевые достижения:

- **Экспоненциальный рост вычислительной мощности**: Увеличение числа транзисторов позволило создавать процессоры, способные выполнять всё более сложные вычисления, что привело к появлению современных приложений, таких как искусственный интеллект и обработка больших данных.
- **Снижение стоимости транзисторов**: По мере роста плотности транзисторов стоимость одного транзистора снижалась, что делало вычислительные устройства более доступными.
- **Миниатюризация устройств**: Уменьшение размеров транзисторов позволило создавать компактные устройства, такие как смартфоны и носимые гаджеты, сохраняя при этом высокую производительность.
- **Энергоэффективность**: Современные процессоры стали более энергоэффективными, что особенно важно для мобильных устройств и центров обработки данных.
  
Однако, несмотря на эти достижения, закон Мура сталкивается с рядом ограничений, которые замедляют его действие и требуют поиска новых подходов к развитию технологий.

**3. Ограничения закона Мура**

- **Закон Амдала**
    
![Закон Амдала](https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/AmdahlsLaw.svg/600px-AmdahlsLaw.svg.png)

[Закон Амдала](https://en.wikipedia.org/wiki/Amdahl%27s_law) описывает теоретическое ускорение, которое можно достичь при параллельном выполнении задачи с фиксированной рабочей нагрузкой. Он утверждает, что ускорение ограничено долей кода, которую нельзя распараллелить.

Формула закона Амдала выглядит следующим образом:

![equation](https://media.geeksforgeeks.org/wp-content/uploads/Screenshot-from-2018-06-10-23-26-41.png)

**Fraction Enhanced (Доля улучшения)**: Часть времени вычислений, которую можно улучшить. Например, если из 40 секунд программы 10 секунд могут использовать улучшение, доля = 10/40. Значение всегда < 1.

**Speedup Enhanced (Ускорение улучшения)**: Улучшение скорости за счет улучшенного режима для всей программы. Например, если улучшенный режим занимает 3 секунды вместо 6 секунд в исходном, ускорение = 6/3. Значение всегда > 1.

**Пример:** Если 10% программы является последовательной , т.е. **p = 0.9**, то даже при использовании бесконечного числа процессоров **n →∞**  максимальное ускорение будет **10**. Это означает, что максимальное ускорение ограничено 10-кратным, независимо от количества процессоров. При использовании **10** процессоров ускорение будет **5.26**.

Таким образом, закон Амдала показывает, что последовательные части программы становятся **узким местом**, ограничивая преимущества параллельных вычислений. Это особенно актуально для современных многоядерных процессоров, где увеличение числа ядер не всегда приводит к пропорциональному росту производительности

- **Сложность параллельного программирования**

Параллельное программирование значительно сложнее последовательного из-за необходимости учитывать множество факторов, которые отсутствуют в традиционной разработке программного обеспечения.

Основные проблемы включают:

a. **Синхронизация**: Необходимо обеспечить, чтобы несколько потоков или процессов не конфликтовали при доступе к общим ресурсам. Например, если два потока одновременно пытаются обновить одну и ту же переменную, это может привести к состоянию гонки, когда результат становится непредсказуемым. Для предотвращения таких ситуаций используются механизмы синхронизации, такие как мьютексы или семафоры, но они добавляют накладные расходы.

b. **Взаимные блокировки**: Неправильная синхронизация может привести к ситуациям, когда два или более потока ждут друг друга, чтобы освободить ресурсы, что вызывает остановку программы.

c. **Балансировка нагрузки**: Задачи должны быть равномерно распределены между процессорами, чтобы избежать ситуации, когда одни процессоры простаивают, а другие перегружены. Это особенно сложно в задачах с динамической рабочей нагрузкой.

d. **Масштабируемость**: Алгоритмы должны быть спроектированы так, чтобы эффективно использовать дополнительные ресурсы. Не все алгоритмы хорошо поддаются параллелизации.

e. **Отладка и тестирование**: Параллельные программы могут вести себя недетерминированно, что затрудняет поиск и исправление ошибок. Например, ошибка может проявляться только при определённой последовательности выполнения потоков.

- **Доставка данных**

Проблемы доставки данных в параллельных системах ограничивают закон Мура, так как увеличение числа транзисторов **не** приводит к пропорциональному росту производительности из-за **задержек и узких мест в коммуникации**. 

## Проблемы, связанные с аппаратным обеспечением
Любая компьютерная система, хотим мы того или нет, имеет в своём составе аппаратную составляющую (заметим, что сегодня в некотором смысле это не так, но к этому мы вернемся ближе к концу курса). Даже определение системы с преобладающей программной составляющей выглядит следующим образом:

software system
: A system made up of software, hardware, and data that provides its primary value by the execution of the software.
: --- OMG Essence

С этим связано множество трудностей, рассмотрим некоторые их них:

### Старение аппаратной составляющей

- У аппаратной части компьютерной системы есть свой срок службы, по истечении которого она лишается гарантии, риск внезапного выхода из строя резко возрастает, она требует обслуживания.
- Замена аппаратной составляющей затруднена сложностью и дороговизной долгого хранения деталей для ремонта или замены.
- Воспроизводство аппаратной составляющей сопряжено с устареванием элементной базы. Устаревшая элементная база вытесняется из производства новой, и, как следствие, она довольно быстро переходит в разряд штучной, которая:
    - сперва производится несколькими компаниями за очень большие деньги;
    - потом не производится совсем (периодически можно видеть, как крупные компании ищут то или иное оборудование по барахолкам; есть и компании, которые на этом специализируются).
- Вслед за элементной базой из оборота уходит сопутствующее оборудование (кто бы мог подумать, что в компьютерах не будет CD-ROM дисков, а производство дискет 2.5 дюйма будет остановлено).

В результате современные компьютерные системы с аппаратной точки зрения вынуждены претерпевать постоянное перепроектирование просто для того, чтобы быть тиражируемыми. Другие варианты:

- разделение системы на части по стандартным интерфейсам (аппаратным, информационным или программным), относительно которых модернизация может происходить условно независимо, пока не нарушаются контракты (стандартизация);
- виртуализация --- на сегодня продолжает существовать такой класс компьютерных систем, как "мейнфреймы", многие из которых по-прежнему работают с магнитными лентами и перфокартами.

Обратная сторона. Программное обеспечение может жить вечно, так как "команды и коды не стареют", чего, к сожалению, нельзя сказать о командах разработчиков. Как следствие --- держатель компьютерной системы рано или поздно в любом случае будет терять над ней контроль.

### Сложность внесения изменений

Как уже отмечалось выше, производство аппаратуры сопряжено со сложным технологическим процессом, и чем этот процесс совершеннее (выше уровень интеграции), тем он труднее. Если для навесного монтажа возможно скорректировать схему в широких пределах, то для интегральных схем это едва представляется возможным, так как сопряжено с большими капиталовложениями и затратами времени, и зачастую "исправление" будет равно "созданию с нуля".

_Примечание_: речь идет именно о применении "патча", а не о его разработке. Разработка патча может иметь произвольную сложность, особенно в программном обеспечении.

В то же время в случае с программным обеспечением это сделать гораздо проще (если мы говорим о современных методах распространения ПО):

- надо применить патч к программной документации (зачем [GitFlow](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow) такой сложный?);
- повторно собрать проект (зачем [bazel](https://bazel.build), [nixos](https://nixos.org) и, отчасти, [docker](https://www.docker.com)?);
- обновить программное обеспечение на компьютерах и перезапустить (в чём сложности достижения консистентного состояния, зачем CD?).

Кроме того, изменение аппаратной составляющей подразумевает физический контакт с устройством, что не всегда возможно (см. проект Вояджер) и экономически целесообразно ([Почему управление одним реле с помощью ARM-процессора --- это нормально?](https://alex-avr2.livejournal.com/177508.html)). Также большое значение имеет тираж: если устройство выпущено большой серией, то это означает большое количество контактов с устройством.

Важно сразу отметить, что всё обозначенное здесь далеко не всегда является недостатком, так как легкость изменения ПО является одной из причин огромного количества уязвимостей компьютерных систем. Поэтому фиксация программного обеспечения как части аппаратного --- корректный механизм обеспечения безопасности системы (иногда успешный, а иногда и нет, см. историю про умный замок).

В то же время наличие дорогостоящего и долгого процесса для отладки заставляет разработчиков и бизнес более ответственно подходить к разработке: использовать современные средства разработки, тестировать и проверять реализацию, применять инструменты верификации, а не надеяться на авось. При удачном стечении обстоятельств снижается количество итераций и количество ошибок в полученном решении. Ходит даже шутка времён зари вычислительной техники: из-за перегрузки программисты отдали задачу на решение электронщикам, электронщики согласились и пошли делать, а когда вернулись --- принесли реализацию без ошибок, заработавшую с первого раза. На вопрос: "Как вам удалось написать код без ошибок?", ответили: "А что, можно было делать ошибки?".
