# Особенности производства аппаратуры

<!-- Монтаж РЭА -->

Для того чтобы перейти к вопросу о том, почему нам необходимо отделять Hardware от Software, сперва необходимо обозначить несколько примеров организации производственного процесса для микроэлектроники. Для этого весьма поверхностно обозначим несколько примеров (в данном случае мы не делаем попытку претендовать на полноту рассмотрения).

Первым этапом является проектирование электронного устройства на принципиальном уровне (схемы электрические принципиальные), в рамках которого определяется поведение системы. После этого выполняется адаптация под конкретный способ производства или, в некоторых случаях, под конкретное производство.

[**Навесной монтаж**](https://ru.wikipedia.org/wiki/Навесной_монтаж) --- способ монтажа электронных схем, при котором расположенные на изолирующем шасси радиоэлементы соединяются друг с другом проводами или непосредственно выводами.

Недостаток навесного монтажа --- плохо поддаётся автоматизации и обычно выполняется монтажниками вручную. В настоящее время в массовом производстве применяется редко и обычно только при монтаже крупногабаритных деталей.

Для навесного монтажа часто используются так называемые макетные или монтажные платы, которые являются универсальной "платой" для прототипирования простых электронных схем, не требующих высокого уровня интеграции (элементы крупные, и их немного).

[**Монтаж на печатную плату**](https://ru.wikipedia.org/wiki/Печатная_плата). Печатная плата --- пластина из диэлектрика, на поверхности и/или в объёме которой сформированы электропроводящие цепи электронной схемы. Печатная плата предназначена для электрического и механического соединения различных электронных компонентов. Электронные компоненты на печатной плате соединяются своими выводами с элементами проводящего рисунка обычно пайкой.

Печатные платы классифицируются, в том числе и по количеству слоев металлизации, выделяются как одно- и двухслойные платы (проводники проходят только по поверхности платы), так и многослойные платы, где количество слоев обуславливается практической целесообразностью: действительно сложные платы физически невозможно "развести" на двух слоях, когда отдельные компоненты имеют сотни выходных контактов.

Монтаж на печатную плату позволяет использовать гораздо более мелкую элементную базу, когда размер элементов составляет десятые доли миллиметров (навесной монтаж в таком случае является практически невозможным); использовать элементы с огромным количеством контактов (например [BGA](https://en.wikipedia.org/wiki/Ball_grid_array)); добиться гораздо более технологичного процесса производства и высокого качества, необходимого для высокочастотных устройств (к примеру, выравнивание длины проводников); получить невозможный для навесного монтажа уровень интеграции; и т.д. Современные печатные платы, помимо проводников, могут также содержать и пассивные элементы, встроенные в слои металлизации.

В то же время использование печатных плат удлиняет производственную цепочку (выделяется этап подготовки документации на плату и ее производство перед монтажом) и затрудняет возможность что-то исправить после производства (разрезать проводник или "бросить контакт", по сути, можно, только если это внешний слой).

[**Кремниевое производство**](https://ru.wikipedia.org/wiki/Технологический_процесс_в_электронной_промышленности).

Отсылаю к внешнему источнику: Технологии микроэлектроники на пальцах: «закона Мура», маркетинговые ходы и почему нанометры нынче не те. [Часть 1](https://habr.com/ru/post/453438/), [Часть 2](https://habr.com/ru/post/456298/), [Часть 3](https://habr.com/ru/post/456306/).

С чем связаны разные частоты в, казалось бы, одинаковых процессорах? Откуда была линейка процессоров Celeron? Почему в процессорах бывает разное количество процессоров?

В контексте производства интегральных схем нельзя не упомянуть [закон Мура](https://ru.wikipedia.org/wiki/Закон_Мура), согласно которому (в современной формулировке) количество транзисторов, размещаемых на кристалле интегральной схемы, удваивается каждые 24 месяца. К сожалению, он сдерживается следующими факторами:

- закон Амдала (фундаментальное ограничение на параллелизм, к нему мы вернемся позднее);
- объективная сложность параллельного программирования (современное многопоточное программирование может быть реализовано средним современным программистом только за счет большого количества абстракций, позволяющих просто работать с простыми случаями разработки, к этому вопросу мы вернемся позднее);
- доставка данных, так как для работы необходимо не только получить входные данные, но и выдать полученные результаты (возможно, и промежуточные);
- тепловыделение и питание (см. [Dark Silicon](https://en.wikipedia.org/wiki/Dark_silicon));
- ограничения, связанные с физическими процессами (к примеру, когда не остается атомов для того, чтобы сложить затвор транзистора).

## Проблемы, связанные с аппаратным обеспечением

Любая компьютерная система, хотим мы того или нет, имеет в своём составе аппаратную составляющую (заметим, что сегодня в некотором смысле это не так, но к этому мы вернемся ближе к концу курса). Даже определение системы с преобладающей программной составляющей выглядит следующим образом:

software system
: A system made up of software, hardware, and data that provides its primary value by the execution of the software.
: --- OMG Essence

С этим связано множество трудностей, рассмотрим некоторые их них:

### Старение аппаратной составляющей

- У аппаратной части компьютерной системы есть свой срок службы, по истечении которого она лишается гарантии, риск внезапного выхода из строя резко возрастает, она требует обслуживания.
- Замена аппаратной составляющей затруднена сложностью и дороговизной долгого хранения деталей для ремонта или замены.
- Воспроизводство аппаратной составляющей сопряжено с устареванием элементной базы. Устаревшая элементная база вытесняется из производства новой, и, как следствие, она довольно быстро переходит в разряд штучной, которая:
    - сперва производится несколькими компаниями за очень большие деньги;
    - потом не производится совсем (периодически можно видеть, как крупные компании ищут то или иное оборудование по барахолкам; есть и компании, которые на этом специализируются).
- Вслед за элементной базой из оборота уходит сопутствующее оборудование (кто бы мог подумать, что в компьютерах не будет CD-ROM дисков, а производство дискет 2.5 дюйма будет остановлено).

В результате современные компьютерные системы с аппаратной точки зрения вынуждены претерпевать постоянное перепроектирование просто для того, чтобы быть тиражируемыми. Другие варианты:

- разделение системы на части по стандартным интерфейсам (аппаратным, информационным или программным), относительно которых модернизация может происходить условно независимо, пока не нарушаются контракты (стандартизация);
- виртуализация --- на сегодня продолжает существовать такой класс компьютерных систем, как "мейнфреймы", многие из которых по-прежнему работают с магнитными лентами и перфокартами.

Обратная сторона. Программное обеспечение может жить вечно, так как "команды и коды не стареют", чего, к сожалению, нельзя сказать о командах разработчиков. Как следствие --- держатель компьютерной системы рано или поздно в любом случае будет терять над ней контроль.

### Сложность внесения изменений

Как уже отмечалось выше, производство аппаратуры сопряжено со сложным технологическим процессом, и чем этот процесс совершеннее (выше уровень интеграции), тем он труднее. Если для навесного монтажа возможно скорректировать схему в широких пределах, то для интегральных схем это едва представляется возможным, так как сопряжено с большими капиталовложениями и затратами времени, и зачастую "исправление" будет равно "созданию с нуля".

_Примечание_: речь идет именно о применении "патча", а не о его разработке. Разработка патча может иметь произвольную сложность, особенно в программном обеспечении.

В то же время в случае с программным обеспечением это сделать гораздо проще (если мы говорим о современных методах распространения ПО):

- надо применить патч к программной документации (зачем [GitFlow](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow) такой сложный?);
- повторно собрать проект (зачем [bazel](https://bazel.build), [nixos](https://nixos.org) и, отчасти, [docker](https://www.docker.com)?);
- обновить программное обеспечение на компьютерах и перезапустить (в чём сложности достижения консистентного состояния, зачем CD?).

Кроме того, изменение аппаратной составляющей подразумевает физический контакт с устройством, что не всегда возможно (см. проект Вояджер) и экономически целесообразно ([Почему управление одним реле с помощью ARM-процессора --- это нормально?](https://alex-avr2.livejournal.com/177508.html)). Также большое значение имеет тираж: если устройство выпущено большой серией, то это означает большое количество контактов с устройством.

Важно сразу отметить, что всё обозначенное здесь далеко не всегда является недостатком, так как легкость изменения ПО является одной из причин огромного количества уязвимостей компьютерных систем. Поэтому фиксация программного обеспечения как части аппаратного --- корректный механизм обеспечения безопасности системы (иногда успешный, а иногда и нет, см. историю про умный замок).

В то же время наличие дорогостоящего и долгого процесса для отладки заставляет разработчиков и бизнес более ответственно подходить к разработке: использовать современные средства разработки, тестировать и проверять реализацию, применять инструменты верификации, а не надеяться на авось. При удачном стечении обстоятельств снижается количество итераций и количество ошибок в полученном решении. Ходит даже шутка времён зари вычислительной техники: из-за перегрузки программисты отдали задачу на решение электронщикам, электронщики согласились и пошли делать, а когда вернулись --- принесли реализацию без ошибок, заработавшую с первого раза. На вопрос: "Как вам удалось написать код без ошибок?", ответили: "А что, можно было делать ошибки?".
